#!/usr/bin/env bash

set -eo pipefail

CURRENT=$(pwd)

info() {
    printf "  [ \033[00;34m..\033[0m ] %s" "$1"
}

success() {
    printf "\r\033[2K  [ \033[00;32mOK\033[0m ] %s\n" "$1"
}

fail() {
    printf "\r\033[2K  [\033[0;31mFAIL\033[0m] %s\n" "$1"
    echo ''
    exit
}

link_files() {
    if [ -L "$2" ] ; then
        rm -f "$2"
    fi

    ln -s "$CURRENT/$1" "$2"
    success "linked $1 to $2"
}

ensure_dir() {
    if [ ! -d "$1" ] ; then
        mkdir -p "$1"

        success "created directory $1"
    fi
}

setup_git() {
    brew install git bash-completion
    link_files git/git-completion.bash ~/.git-completion.bash
    link_files git/config ~/.gitconfig
    link_files git/ignore ~/.gitignore
}

setup_zsh_iterm() {
  sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
  git clone https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k
  brew install zsh-syntax-highlighting
}

# git
setup_git
setup_zsh_iterm

# vim
link_files vim ~/.vim
link_files vim/vimrc ~/.vimrc

# bash
link_files bash/rc      ~/.bashrc
link_files bash/profile ~/.bash_profile
link_files bash/aliases ~/.bash_aliases

# zsh
link_files zsh/rc ~/.zshrc

# home
link_files inputrc  ~/.inputrc
link_files screenrc ~/.screenrc

# Generates a ssh key for my user
if [ ! -f ~/.ssh/id_rsa ]; then
    ssh-keygen -t rsa -b 4096 -C "contato@hugohenrique.com.br" -N "" -f ~/.ssh/id_rsa -q
fi

echo ''
echo '  All installed!'

source ~/.bashrc
